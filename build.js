const fs = require('fs');
const path = require('path');

const build = () => {
    try {
        // Read the files
        const html = fs.readFileSync(path.join(__dirname, 'index.html'), 'utf-8');
        const css = fs.readFileSync(path.join(__dirname, 'style.css'), 'utf-8');
        const js = fs.readFileSync(path.join(__dirname, 'keys.js'), 'utf-8');
        const talks = fs.readFileSync(path.join(__dirname, 'talks.json'), 'utf-8');

        // Replace the link and script tags with the actual content
        let builtHtml = html.replace('<link rel="stylesheet" href="style.css">', `<style>${css}</style>`);
        builtHtml = builtHtml.replace('<script src="keys.js"></script>', `<script>const talksData = ${talks};${*js}</script>`);
        
        // Adjust the script to use the embedded data
        builtHtml = builtHtml.replace(bfetch('talks.json')
        .then(response => response.json())
        .then(data => {
            talks = data;
            renderSchedule(talks);
        });`, `talks = talksData;
        renderSchedule(talks);`);

        // Write the built file
        fs.writeFileSync(path.join(__dirname, 'dist', 'index.html'), builtHtml);
        console.log('Build successful! The serverless file is located in dist/index.html');

    } catch (error) {
        console.error('Build failed:', error);
    }
};

// Create dist directory if it doesn't exist
if (!fs.existsSync(path.join(__dirname, 'dist'))) {
    fs.mkdirSync(path.join(__dirname, 'dist'));
}

build();
